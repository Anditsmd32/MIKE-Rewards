<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Information</title>
</head>
<body>

    <label for="walletAddress">Enter Ethereum Address: </label>
    <input type="text" id="walletAddress" placeholder="Enter Ethereum address">
    <button onclick="fetchTokenInfo()">Fetch Token Info</button>

    <div id="tokenTable"></div>

    <button onclick="getRewardData()">Get Reward Data</button>
    <div id="rewardData"></div>

    <script>
        function fetchTokenInfo() {
            const walletAddress = document.getElementById('walletAddress').value;

            // Replace these contract addresses with the actual ones you want to check
            const contractAddresses = [
                '0x5b17a3d673c47c30a1e87e238dd31ad437158141',
                '0x75da7f3e6811e56b6f8e0a21ea79cffaef0fc2b8',
                '0x47273ee3360b936e1c9f2bc808da76e1df4b43c4',
                '0x282cecf3fef68cf38ee3e3880f69572c376b9cc1',
                '0x737fd5b88524d0b90b984ba4f64a6b81b1a1dbc0',
                '0xfa9ff85e0df45752df23d65d3b91e2b788c197bf',
                '0x61496615a3cc5f3bed6dad8cf3945cb6d7765f02'
            ];

            // API URL with the wallet address
            const apiUrl = `https://api.scan.pulsechain.com/api?module=account&action=tokenlist&address=${walletAddress}`;

            // Fetch data from the API
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    // Check if each contract address is present in the wallet
                    const foundContracts = contractAddresses.filter(address => {
                        return data.result.some(token => token.contractAddress.toLowerCase() === address.toLowerCase());
                    });

                    // Create a table and append it to the webpage
                    const tokenTableDiv = document.getElementById('tokenTable');
                    tokenTableDiv.innerHTML = '';

                    if (foundContracts.length > 0) {
                        const table = document.createElement('table');
                        table.border = '1';

                        // Add table header
                        const headerRow = table.insertRow(0);
                        headerRow.insertCell(0).textContent = 'Contract Address';
                        headerRow.insertCell(1).textContent = 'Token Name';
                        headerRow.insertCell(2).textContent = 'Token Symbol';
                        headerRow.insertCell(3).textContent = 'Balance';
                        headerRow.insertCell(4).textContent = 'Decimals';
                        headerRow.insertCell(5).textContent = 'Reward';
                        headerRow.insertCell(6).textContent = 'Reward Claimed';

                        // Add table rows for each found contract
                        foundContracts.forEach(contract => {
                            const token = data.result.find(t => t.contractAddress.toLowerCase() === contract.toLowerCase());
                            const row = table.insertRow();
                            row.insertCell(0).textContent = token.contractAddress;
                            row.insertCell(1).textContent = token.name;
                            row.insertCell(2).textContent = token.symbol;

                            // Format balance based on decimals
                            const formattedBalance = (token.balance / 10**token.decimals).toLocaleString(undefined, {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: token.decimals
                            });

                            row.insertCell(3).textContent = formattedBalance;
                            row.insertCell(4).textContent = token.decimals;

                            // Add empty cells for reward and reward claimed
                            row.insertCell(5);
                            row.insertCell(6);
                        });

                        tokenTableDiv.appendChild(table);
                    } else {
                        tokenTableDiv.innerHTML = 'No contracts found in the wallet.';
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        function formatRewardValue(rewardWei) {
            // Convert Wei to Ether and format the result
            const rewardEther = web3.utils.fromWei(rewardWei, 'ether');
            return parseFloat(rewardEther).toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 6
            }) + ' ETH';
        }

        function getRewardData() {
            const contractAddresses = [
                '0x5b17a3d673c47c30a1e87e238dd31ad437158141',
                '0x75da7f3e6811e56b6f8e0a21ea79cffaef0fc2b8',
                '0x47273ee3360b936e1c9f2bc808da76e1df4b43c4',
                '0x282cecf3fef68cf38ee3e3880f69572c376b9cc1',
                '0x737fd5b88524d0b90b984ba4f64a6b81b1a1dbc0',
                '0xfa9ff85e0df45752df23d65d3b91e2b788c197bf',
                '0x61496615a3cc5f3bed6dad8cf3945cb6d7765f02'
            ];

            // Replace 'YOUR_ETH_ADDRESS' with the Ethereum address for which you want to get reward data
            const ethAddress = document.getElementById('walletAddress').value;

            contractAddresses.forEach(contract => {
                const apiUrl = `https://api.scan.pulsechain.com/api/v2/smart-contracts/${contract}/query-read-method?is_custom_abi=false`;

                const payload = {
                    args: [ethAddress],
                    method_id: 'aceac856',
                    contract_type: 'regular'
                };

                fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                })
                .then(response => response.json())
                .then(data => {
                    // Update the corresponding cells in the table with the reward and reward claimed values
                    const table = document.getElementById('tokenTable').getElementsByTagName('table')[0];
                    const rowIndex = contractAddresses.indexOf(contract) + 1; // Adding 1 to account for the header row
                    const rewardCellIndex = 5; // The index of the cell for reward data
                    const rewardClaimedCellIndex = 6; // The index of the cell for reward claimed data

                    if (table.rows[rowIndex]) {
                        // Format and display reward and reward claimed values in ETH format
                        table.rows[rowIndex].cells[rewardCellIndex].textContent = formatRewardValue(data.result.output[0].value);
                        table.rows[rowIndex].cells[rewardClaimedCellIndex].textContent = formatRewardValue(data.result.output[1].value);
                    }
                })
                .catch(error => {
                    console.error('Error fetching reward data:', error);
                });
            });
        }
    </script>

</body>
</html>
